<div *ngIf="project">
  <div class="header">
    <div class="pointer back" routerLink="/">
      <i class="fa-solid fa-arrow-left fa-lg"></i>
      <span>Back</span>
    </div>
    <div class="name">
      <ng-container *ngIf="!editName; else editNameInput">
        <h2>{{ project.data.name }}</h2>
        <div class="pointer" (click)="editName = true">
          <i class="fa-solid fa-pen fa-lg"></i>
        </div>
      </ng-container>
      <ng-template #editNameInput>
        <input type="text"
               [(ngModel)]="project.data.name"
               [ngClass]="{ 'ng-invalid': project.data.name.length < 1 || project.data.name.length > 16 }"
               (change)="saveProjectName()">
        <div *ngIf="project.data.name.length > 0 && project.data.name.length <= 16"
             class="pointer"
             (click)="editName = false">
          <i class="fa-solid fa-xmark fa-lg"></i>
        </div>
      </ng-template>
    </div>
    <div class="options">
      <div class="pointer" (click)="archive()">
        <i class="fa-solid fa-box-archive fa-lg"></i>
      </div>
      <div class="pointer" (click)="delete()">
        <i class="fa-solid fa-trash fa-lg"></i>
      </div>
    </div>
  </div>

  <div>
    <div class="input">
      <label for="description">Description</label>
      <textarea
        id="description"
        type="text"
        [(ngModel)]="project.data.description"
        (ngModelChange)="projectService.saveProject(project)">
        </textarea>
    </div>

    <div class="categories">
      <div *ngFor="let category of categoryService.categories" class="category">
        <div>{{ category.data.label }}</div>
      </div>
      <form *ngIf="createCategoryForm" [formGroup]="createCategoryForm"
            (ngSubmit)="createCategoryForm.valid && createCategory()">
        <div class="category-form">
          <div class="form-row">
            <div class="input">
              <label for="category-label">Label</label>
              <input id="category-label"
                     type="text"
                     formControlName="label"
                     autocomplete="off"
                     required>
              <app-errors [control]="categoryLabel"></app-errors>
            </div>

            <div class="input">
              <label for="category-budget">Budget</label>
              <input id="category-budget"
                     type="number"
                     formControlName="budget"
                     required>
              <app-errors [control]="categoryBudget"></app-errors>
            </div>

            <div class="input">
              <label for="category-end-date">End date</label>
              <input id="category-end-date"
                     type="date"
                     formControlName="endDate">
              <app-errors [control]="categoryEndDate"></app-errors>
            </div>
          </div>


          <div>
            <button type="submit">Create category</button>
          </div>
        </div>
      </form>
    </div>

    <div class="balances">
      <form *ngIf="createBalanceForm" [formGroup]="createBalanceForm"
            (ngSubmit)="createBalanceForm.valid && createBalance()">
        <div class="balance-form">
          <div class="form-row">
            <div class="input">
              <label for="balance-label">Label</label>
              <input id="balance-label"
                     type="text"
                     formControlName="label"
                     autocomplete="off"
                     required>
              <app-errors [control]="balanceLabel"></app-errors>
            </div>

            <div class="input">
              <label for="balance-amount">Amount</label>
              <input id="balance-amount"
                     type="number"
                     formControlName="amount"
                     required>
              <app-errors [control]="balanceAmount"></app-errors>
            </div>
          </div>

          <div>
            <button type="submit">Create balance</button>
          </div>
        </div>
      </form>
      <div class="selector">
        <div class="pointer" (click)="changeMonth(-1)">
          <i class="fa-solid fa-chevron-left"></i>
        </div>
        <div class="month">
          {{ formattedDate }}
        </div>
        <div class="pointer" (click)="changeMonth(1)">
          <i class="fa-solid fa-chevron-right"></i>
        </div>
      </div>
      <ng-container *ngIf="balances">
        <!--TODO EDIT NAME AND AMOUNT-->
        <div *ngFor="let balance of balances" class="balance">
          <div class="box">
            <div class="label">{{ balance.data.label }}</div>
            <div>{{ balance.data.date | date }}</div>
            <input *ngIf="balance.editDate"
                   type="date"
                   [(ngModel)]="balance.dateString"
                   (change)="setDate(balance)">
            <div (click)="balance.editDate = !balance.editDate">
              <div *ngIf="balance.editDate">
                <i class="fa-solid fa-xmark"></i>
              </div>
              <div *ngIf="!balance.editDate">
                <i class="fa-solid fa-pen"></i>
              </div>
            </div>
          </div>
          <div class="box"
               [ngClass]="{ negative: (balance.data.amount ?? 0) < 0 }">
            <div class="amount">{{ balance.data.amount | currency: 'EUR':'symbol' }}</div>
            <div class="pointer" (click)="deleteBalance(balance)">
              <i class="fa-solid fa-trash"></i>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>
